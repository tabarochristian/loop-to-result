<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Experiment Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body { background-color: #f3f4f6; }
        .sidebar { 
            width: 200px; 
            background-color: #ffffff; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .content { margin-left: 220px; }
        .status-pending { color: #d97706; font-weight: bold; }
        .status-running { color: #2563eb; font-weight: bold; }
        .status-success { color: #16a34a; font-weight: bold; }
        .status-failed { color: #dc2626; font-weight: bold; }
        .status-stopped { color: #6b7280; font-weight: bold; }
        .input-form { 
            background-color: #ffffff; 
            border-radius: 8px; 
            padding: 1rem; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
        }
        .toast { 
            position: fixed; 
            bottom: 20px; 
            right: 20px; 
            background-color: #10b981; 
            color: white; 
            padding: 0.75rem; 
            border-radius: 6px; 
            display: none; 
            animation: fadeIn 0.3s, fadeOut 0.3s 2.7s;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
    </style>
</head>
<body>
    <div class="sidebar fixed top-0 left-0 h-full p-4">
        <h3 class="text-lg font-semibold mb-4 text-gray-800">Experiments</h3>
        <div class="space-y-2">
            {% for exp in experiments %}
            <div class="bg-white p-3 rounded-lg shadow-sm flex justify-between items-center">
                <a href="/progress/{{ exp.id }}" class="text-sm text-blue-600 hover:underline">
                    #{{ exp.id[:8] }} <span class="status-{{ exp.status }}">{{ exp.status }}</span>
                </a>
                <form action="/delete/{{ exp.id }}" method="POST" onsubmit="return confirm('Are you sure you want to stop and delete this experiment?');">
                    <button type="submit" class="text-red-600 hover:text-red-800 text-sm">Delete</button>
                </form>
            </div>
            {% endfor %}
        </div>
    </div>
    <div class="content p-6">
        <h1 class="text-xl font-bold text-gray-800 mb-4">Experiment Dashboard</h1>
        <div class="input-form">
            <h2 class="text-lg font-semibold text-gray-800 mb-4">Start New Experiment</h2>
            <form id="start-form" method="POST" action="/start" class="space-y-4">
                <div>
                    <label for="prompt" class="block text-sm font-medium text-gray-700">Prompt</label>
                    <textarea id="prompt" name="prompt" class="w-full border border-gray-300 rounded-lg p-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" rows="4" placeholder="Enter your prompt..." required></textarea>
                </div>
                <div>
                    <label for="model" class="block text-sm font-medium text-gray-700">AI Model</label>
                    <select id="model" name="model" class="w-full border border-gray-300 rounded-lg p-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        <option value="grok:grok-beta">Grok (Beta)</option>
                        <option value="grok:grok-2">Grok 2</option>
                        <option value="grok:grok-3">Grok 3</option>
                        <option value="grok:grok-3-latest">Grok 3 Latest</option>
                    </select>
                </div>
                <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 text-sm">Start Experiment</button>
            </form>
        </div>
        <div id="toast" class="toast">Experiment started successfully!</div>
    </div>
    <script>
        // AJAX form submission for starting a new experiment
        document.getElementById("start-form").addEventListener("submit", function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            fetch("/start", {
                method: "POST",
                body: formData
            }).then(response => {
                if (response.ok) {
                    document.getElementById("prompt").value = "";
                    document.getElementById("model").selectedIndex = 0;
                    const toast = document.getElementById("toast");
                    toast.style.display = "block";
                    setTimeout(() => toast.style.display = "none", 3000);
                    // Optionally redirect to the new experiment's progress page
                    response.json().then(data => {
                        setTimeout(() => window.location.href = `/progress/${data.id}`, 1000);
                    });
                } else {
                    console.error("Failed to start experiment");
                }
            }).catch(error => console.error("Error starting experiment:", error));
        });
    </script>
</body>
</html>